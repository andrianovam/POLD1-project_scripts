d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "atac"
d_full = rbind(d_full, d1_full)
}
head(d_full)
head(df)
head(df_epigenetics)
d_full=NULL
for (i in c(2:(ncol(df)-10))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df)-1)]
print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "h3k4me"
d_full = rbind(d_full, d1_full)
}
for (i in c(2:(ncol(df)-13))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df))]
print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
#d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
#d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "atac"
d_full = rbind(d_full, d1_full)
}
head(d_full)
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
unique(d_full$type)
d_full=NULL
for (i in c(2:(ncol(df)-10))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df)-1)]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "h3k4me"
print(d1_full)
d_full = rbind(d_full, d1_full)
}
for (i in c(2:(ncol(df)-13))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df))]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
#d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
#d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "atac"
print(d1_full)
d_full = rbind(d_full, d1_full)
}
d_full=NULL
for (i in c(2:(ncol(df)-10))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df)-1)]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "h3k4me"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
for (i in c(2:(ncol(df)-13))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df))]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
#d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
#d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "atac"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
library(ggcorrplot)
library(reshape2)
library("gplots")
library(stringr)
library(dplyr)
library(utils)
df_sites = read.table("/home/mandrianova/Lab/damage_maps/results/yeasts_chromosomes_1kb_division.csv", header=T, sep="\t")
df_sites$GC = df_sites$G + df_sites$C
h3k4me = read.table("/home/mandrianova/Lab/damage_maps/data/chromatin_marks/yeasts_h3k4me_1kb.out")
colnames(h3k4me)[1]<-"state"
colnames(h3k4me)[6]<-"h3k4me"
atac = read.table("/home/mandrianova/Lab/damage_maps/data/chromatin_marks/yeasts_GSE66386_ATACseq_lin_all.nucleoatac_signal_1kb.out")
colnames(atac)[1]<-"state"
colnames(atac)[6]<-"atac"
atac=atac[atac$atac > 0,]
df_epigenetics = merge(h3k4me[,c(1,6)], atac[,c(1,6)], by="state")
damages<-data.frame()
for (file in c(list.files(path = "/home/mandrianova/Lab/damage_maps/yeast_Mao/genome_chunks", pattern="1kb*", full.names = TRUE))){
#for (file in c(list.files(path = "/home/mandrianova/Lab/damage_maps/yeasts/genome_chunks", pattern="1kb*", full.names = TRUE))){
print(file)
sample = strsplit(file, "1kb_")[[1]][2]
sample1 = strsplit(sample, ".agg")[[1]][1]
print(sample1)
damages_sample = read.table(file, sep="\t", header = T)
colnames(damages_sample)<-c("state", sample1)
if (nrow(damages) == 0){
damages = damages_sample
}else{
damages = merge(damages, damages_sample, by="state")
}
head(damages)
}
df = merge(damages, df_sites, by="state")
df = merge(df, df_epigenetics, by="state")
#df=df[df$h3k4me >0 & df$h3k4me < 500,]
df=df[df$yeast_mag1_2_0h_1_G_both.dedup >250,]
#df=df[df$NOVOGENE_19_yeast_mag1_MMS_0h_1_G_both.dedup >140,]
head(df)
d_full=NULL
for (i in c(2:(ncol(df)-10))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df)-1)]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "h3k4me"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
for (i in c(2:(ncol(df)-13))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df))]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
#d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
#d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "atac"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
unique(d_full$type)
ncol(df)
head(df)
ncol(df)-10
d_full=NULL
for (i in c(2:(ncol(df)-10))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df)-1)]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "h3k4me"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
for (i in c(2:(ncol(df)-10))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df))]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
#d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
#d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "atac"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
d_full=NULL
for (i in c(2:(ncol(df)-1))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df)-1)]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "h3k4me"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
d_full=NULL
for (i in c(2:(ncol(df)-11))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df)-1)]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "h3k4me"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
for (i in c(2:(ncol(df)-11))){
print(i)
d1_full = df[,c(1,i, ncol(df)-2, ncol(df))]
#print(head(d1_full))
colnames(d1_full)[2] = "value"
colnames(d1_full)[4] = "mark_value"
d1_full$damage_rate_norm = apply(d1_full, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1_full[,2])))
#d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
#d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
d1_full$name = str_split_i(colnames(df)[i],"[.]",1)
d1_full$mode = str_split_i(colnames(df)[i],"[.]",2)
#d1_full$type = paste(str_split_i(colnames(df)[i],"_",4), str_split_i(colnames(df)[i],"_",6), sep="_")
d1_full$type = str_split_i(str_split_i(colnames(df)[i],"_1",1), "st_",2)
d1_full$mark = "atac"
print(head(d1_full))
d_full = rbind(d_full, d1_full)
}
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)")+geom_smooth(method="lm"))
(ggplot(d_full[d_full$mark=="h3k4me",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()+xlab("log(h3k4me)"))
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeasts_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb_vs_ATAC.jpeg", width=25, height=15, res=300, units='cm')
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb_vs_ATAC.jpeg", width=25, height=15, res=300, units='cm')
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
dev.off()
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb_vs_h3k4me.jpeg", width=25, height=15, res=300, units='cm')
(ggplot(d_full[d_full$mark=="h3k4me",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~type, scale="free")
+ theme_bw()+xlab("log(h3k4me)"))
dev.off()
q1_atac = quantile(df$atac)[2]
q2_atac = quantile(df$atac)[3]
q3_atac = quantile(df$atac)[4]
q1_h3k4me = quantile(df$h3k4me)[2]
q2_h3k4me = quantile(df$h3k4me)[3]
q3_h3k4me = quantile(df$h3k4me)[4]
#ggplot(df, aes(x=log(V6), y=log(df[,2]/GC)))+geom_point()+geom_smooth(method = "lm")
df$h3k4me_bin = ifelse(df$h3k4me < q1_h3k4me, "q1", ifelse (df$h3k4me < q2_h3k4me, "q2", ifelse(df$h3k4me < q3_h3k4me, "q3", "q4")))
df_agg_h3k4me = aggregate(df[,c(2:7,16)], list(df$h3k4me_bin), "sum")
df$atac_bin = ifelse(df$atac < q1_atac, "q1", ifelse (df$atac < q2_atac, "q2", ifelse(df$atac < q3_atac, "q3", "q4")))
df_agg_atac = aggregate(df[,c(2:7,16)], list(df$atac_bin), "sum")
d=NULL
for (i in c(2:(ncol(df_agg_h3k4me)-1))){
print(i)
d1 = df_agg_h3k4me[,c(1,i, ncol(df_agg_h3k4me))]
print(head(d1))
colnames(d1)[2] = "value"
d1$value_norm = apply(d1, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1[,2])))
d1$name = str_split_i(colnames(df_agg_h3k4me)[i],"[.]",1)
d1$mode = str_split_i(colnames(df_agg_h3k4me)[i],"[.]",2)
d1$type = paste(str_split_i(colnames(df_agg_h3k4me)[i],"_",4), str_split_i(colnames(df_agg_h3k4me)[i],"_",6), sep="_")
d1$mark = "h3k4me"
d = rbind(d, d1)
}
for (i in c(2:(ncol(df_agg_atac)-1))){
print(i)
d1 = df_agg_atac[,c(1,i, ncol(df_agg_atac))]
print(head(d1))
colnames(d1)[2] = "value"
d1$value_norm = apply(d1, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1[,2])))
d1$name = str_split_i(colnames(df_agg_atac)[i],"[.]",1)
d1$mode = str_split_i(colnames(df_agg_atac)[i],"[.]",2)
d1$type = paste(str_split_i(colnames(df_agg_atac)[i],"_",4), str_split_i(colnames(df_agg_atac)[i],"_",6), sep="_")
d1$mark = "atac"
d = rbind(d, d1)
}
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb.jpeg", width=15, height=15, res=300, units='cm')
(ggplot(d, aes(x=Group.1, y=value_norm, fill=factor(type, levels = c("mag1_2_0h", "wt1_0h", "wt_2h"))))
+ geom_bar(stat="identity", position="dodge")
+ theme_bw()
+ facet_grid(mark~mode, scale="free_y")
+ scale_fill_manual(values = c("gray31","darkgrey", "darkseagreen3"), name="")
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ epigenetic mark------> High")
+ ylab("G damages normilized by G sites and all G damages")
)
dev.off()
(ggplot(d, aes(x=Group.1, y=value_norm, fill=factor(type, levels = c("mag1_2_0h", "wt1_0h", "wt_2h"))))
+ geom_bar(stat="identity", position="dodge")
+ theme_bw()
+ facet_grid(mark~mode, scale="free_y")
+ scale_fill_manual(values = c("gray31","darkgrey", "darkseagreen3"), name="")
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ epigenetic mark------> High")
+ ylab("G damages normilized by G sites and all G damages")
)
head(d)
unique(d$type)
d=NULL
for (i in c(2:(ncol(df_agg_h3k4me)-1))){
print(i)
d1 = df_agg_h3k4me[,c(1,i, ncol(df_agg_h3k4me))]
print(head(d1))
colnames(d1)[2] = "value"
d1$value_norm = apply(d1, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1[,2])))
d1$name = str_split_i(colnames(df_agg_h3k4me)[i],"[.]",1)
d1$mode = str_split_i(colnames(df_agg_h3k4me)[i],"[.]",2)
#d1$type = paste(str_split_i(colnames(df_agg_h3k4me)[i],"_",4), str_split_i(colnames(df_agg_h3k4me)[i],"_",6), sep="_")
d1$type = str_split_i(str_split_i(colnames(df_agg_h3k4me)[i],"_1",1), "st_",2)
d1$mark = "h3k4me"
d = rbind(d, d1)
}
for (i in c(2:(ncol(df_agg_atac)-1))){
print(i)
d1 = df_agg_atac[,c(1,i, ncol(df_agg_atac))]
print(head(d1))
colnames(d1)[2] = "value"
d1$value_norm = apply(d1, 1, function(x) as.numeric(x[2])/as.numeric(x[3])/sum(as.numeric(d1[,2])))
d1$name = str_split_i(colnames(df_agg_atac)[i],"[.]",1)
d1$mode = str_split_i(colnames(df_agg_atac)[i],"[.]",2)
#d1$type = paste(str_split_i(colnames(df_agg_atac)[i],"_",4), str_split_i(colnames(df_agg_atac)[i],"_",6), sep="_")
d1$type = str_split_i(str_split_i(colnames(df_agg_h3k4me)[i],"_1",1), "st_",2)
d1$mark = "atac"
d = rbind(d, d1)
}
(ggplot(d, aes(x=Group.1, y=value_norm, fill=factor(type, levels = c("mag1_2_0h", "wt1_0h", "wt_2h"))))
+ geom_bar(stat="identity", position="dodge")
+ theme_bw()
+ facet_grid(mark~mode, scale="free_y")
+ scale_fill_manual(values = c("gray31","darkgrey", "darkseagreen3"), name="")
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ epigenetic mark------> High")
+ ylab("G damages normilized by G sites and all G damages")
)
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb.jpeg", width=15, height=15, res=300, units='cm')
(ggplot(d, aes(x=Group.1, y=value_norm, fill=factor(type, levels = c("mag1_2_0h", "wt1_0h", "wt_2h"))))
+ geom_bar(stat="identity", position="dodge")
+ theme_bw()
+ facet_grid(mark~mode, scale="free_y")
+ scale_fill_manual(values = c("gray31","darkgrey", "darkseagreen3"), name="")
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ epigenetic mark------> High")
+ ylab("G damages normilized by G sites and all G damages")
)
dev.off()
############### Remaining damages ############################3
df1 = df[,c("state", "yeast_wt_2h_1_G_both.nodedup", "yeast_mag1_2_0h_1_G_both.nodedup","yeast_wt_2h_1_G_both.dedup", "yeast_mag1_2_0h_1_G_both.dedup", "GC","h3k4me_bin")]
#df1 = df[,c("state", "NOVOGENE_19_yeast_WT_MMS_1h_1_G_both.nondedup", "NOVOGENE_19_yeast_mag1_MMS_0h_1_G_both.nondedup","NOVOGENE_19_yeast_WT_MMS_1h_1_G_both.dedup", "NOVOGENE_19_yeast_mag1_MMS_0h_1_G_both.dedup", "GC","h3k4me_bin","atac_bin")]
df1_agg_h3k4me = aggregate(df1[,c(2:6)], list(df$h3k4me_bin), "sum")
head(df1_agg_h3k4me)
df1 = df[,c("state", "yeast_wt_2h_1_G_both.nodedup", "yeast_mag1_2_0h_1_G_both.nodedup","yeast_wt_2h_1_G_both.dedup", "yeast_mag1_2_0h_1_G_both.dedup", "GC","h3k4me_bin")]
#df1 = df[,c("state", "NOVOGENE_19_yeast_WT_MMS_1h_1_G_both.nondedup", "NOVOGENE_19_yeast_mag1_MMS_0h_1_G_both.nondedup","NOVOGENE_19_yeast_WT_MMS_1h_1_G_both.dedup", "NOVOGENE_19_yeast_mag1_MMS_0h_1_G_both.dedup", "GC","h3k4me_bin","atac_bin")]
df1_agg_h3k4me = aggregate(df1[,c(2:6)], list(df$h3k4me_bin), "sum")
#df1_agg_dedup_h3k4me = df1_agg_h3k4me[,c("Group.1","NOVOGENE_19_yeast_WT_MMS_1h_1_G_both.dedup", "NOVOGENE_19_yeast_mag1_MMS_0h_1_G_both.dedup")]
#df1_agg_dedup_h3k4me$G_remaining = df1_agg_dedup_h3k4me$NOVOGENE_19_yeast_WT_MMS_1h_1_G_both.dedup/df1_agg_dedup_h3k4me$NOVOGENE_19_yeast_mag1_MMS_0h_1_G_both.dedup
df1_agg_dedup_h3k4me = df1_agg_h3k4me[,c("Group.1","yeast_wt_2h_1_G_both.dedup", "yeast_mag1_2_0h_1_G_both.dedup")]
df1_agg_dedup_h3k4me$G_remaining = df1_agg_dedup_h3k4me$yeast_wt_2h_1_G_both.dedup/df1_agg_dedup_h3k4me$yeast_mag1_2_0h_1_G_both.dedup
df1_agg_dedup_h3k4me$mode = "dedup"
df1_agg_dedup_h3k4me$mark = "h3k4me"
df1_agg_nodedup_h3k4me = df1_agg_h3k4me[,c("Group.1","yeast_wt_2h_1_G_both.nodedup", "yeast_mag1_2_0h_1_G_both.nodedup")]
df1_agg_nodedup_h3k4me$G_remaining = df1_agg_nodedup_h3k4me$yeast_wt_2h_1_G_both.nodedup/df1_agg_nodedup_h3k4me$yeast_mag1_2_0h_1_G_both.nodedup
df1_agg_nodedup_h3k4me$mode = "nodedup"
df1_agg_nodedup_h3k4me$mark = "h3k4me"
df1_agg_atac = aggregate(df1[,c(2:6)], list(df$atac_bin), "sum")
df1_agg_dedup_atac = df1_agg_h3k4me[,c("Group.1","yeast_wt_2h_1_G_both.dedup", "yeast_mag1_2_0h_1_G_both.dedup")]
df1_agg_dedup_atac$G_remaining = df1_agg_dedup_atac$yeast_wt_2h_1_G_both.dedup/df1_agg_dedup_atac$yeast_mag1_2_0h_1_G_both.dedup
df1_agg_dedup_atac$mode = "dedup"
df1_agg_dedup_atac$mark = "atac"
df1_agg_nodedup_atac = df1_agg_h3k4me[,c("Group.1","yeast_wt_2h_1_G_both.nodedup", "yeast_mag1_2_0h_1_G_both.nodedup")]
df1_agg_nodedup_atac$G_remaining = df1_agg_nodedup_atac$yeast_wt_2h_1_G_both.nodedup/df1_agg_nodedup_atac$yeast_mag1_2_0h_1_G_both.nodedup
df1_agg_nodedup_atac$mode = "nodedup"
df1_agg_nodedup_atac$mark = "atac"
df1_agg_both = rbind(df1_agg_dedup_h3k4me[,c(1,4,5,6)], df1_agg_nodedup_h3k4me[,c(1,4,5,6)], df1_agg_dedup_atac[,c(1,4,5,6)], df1_agg_nodedup_atac[,c(1,4,5,6)])
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeasts/chromatin_marks/NOVOGENE_19_yeasts_mag_0h_wt_0h_wt_2h_1kb_G_remaining.jpeg", width=15, height=15, res=300, units='cm')
(ggplot(df1_agg_both, aes(x=Group.1, y=G_remaining, group=mode))
+ geom_point()
+ geom_line()
+ theme_bw()
+ facet_wrap(mark~mode, scales = "free", nrow=2)
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ h3k4me------> High")
)
dev.off()
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeasts_Mao/chromatin_marks/yeasts_mag_0h_wt_0h_wt_2h_1kb_G_remaining.jpeg", width=15, height=15, res=300, units='cm')
(ggplot(df1_agg_both, aes(x=Group.1, y=G_remaining, group=mode))
+ geom_point()
+ geom_line()
+ theme_bw()
+ facet_wrap(mark~mode, scales = "free", nrow=2)
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ epigenetic mark------> High")
)
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeasts_mag_0h_wt_0h_wt_2h_1kb_G_remaining.jpeg", width=15, height=15, res=300, units='cm')
(ggplot(df1_agg_both, aes(x=Group.1, y=G_remaining, group=mode))
+ geom_point()
+ geom_line()
+ theme_bw()
+ facet_wrap(mark~mode, scales = "free", nrow=2)
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ epigenetic mark------> High")
)
dev.off()
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb.jpeg", width=15, height=15, res=300, units='cm')
(ggplot(d, aes(x=Group.1, y=value_norm, fill=factor(type, levels = c("mag1_2_0h", "wt1_0h", "wt_2h"))))
+ geom_bar(stat="identity", position="dodge")
+ theme_bw()
+ facet_grid(mark~mode, scale="free_y")
+ scale_fill_manual(values = c("gray31","darkgrey", "darkseagreen3"), name="")
#+ scale_color_manual(values = c("darkslategray4","darkseagreen4","darkseagreen3","darkseagreen2", "darkseagreen2","black", "gray31"))
+ xlab("Low <------ epigenetic mark------> High")
+ ylab("G damages normilized by G sites and all G damages")
)
dev.off()
head(d_full)
unique(d_full$type)
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~factor(type,levels =c("mag1_2_0h","wt1_0h","wt_2h")), scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb_vs_ATAC.jpeg", width=25, height=15, res=300, units='cm')
(ggplot(d_full[d_full$mark=="atac",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~factor(type,levels =c("mag1_2_0h","wt1_0h","wt_2h")), scale="free")
+ theme_bw()
+ xlab("log(ATAC-seq)"))
dev.off()
jpeg(filename="/home/mandrianova/Lab/damage_maps/yeast_Mao/chromatin_marks/yeast_mag_0h_wt_0h_wt_1h_1kb_vs_h3k4me.jpeg", width=25, height=15, res=300, units='cm')
(ggplot(d_full[d_full$mark=="h3k4me",], aes(x=log(mark_value), y=damage_rate_norm, col=mode))
+ geom_point()
+ facet_grid(mode~factor(type,levels =c("mag1_2_0h","wt1_0h","wt_2h")), scale="free")
+ theme_bw()+xlab("log(h3k4me)"))
dev.off()
